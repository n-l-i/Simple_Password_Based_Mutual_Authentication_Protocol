# Simple-Password-Based-MutualAuthentication-Protocol


# Overview


## Values:
    id: The client identifier.
    password: The client password.
    client_salt: The salt used by the client.
    server_id_salt: The salt used by the server for the id field.
    server_password_salt: The salt used by the server for the password field.
    H_c: The hash function used by the client.
    H_s: The hash function used by the server.
    HMAC: The HMAC-SHA-256 algorithm.
    client_nonce: Nonce generated by the client.
    server_nonce: Nonce generated by the server.

## Derivative values:
    hashed_id := H_c(id,HMAC(client_salt,"id salt"))
    hashed_password := H_c(password,HMAC(client_salt,"password salt"))
    double_hashed_id := H_s(hashed_password,server_id_salt)
    double_hashed_password := H_s(hashed_password,server_password_salt)
    client_signature := HMAC(HMAC(double_hashed_password,client_nonce),server_nonce)
    server_signature := HMAC(HMAC(double_hashed_password,server_nonce),client_nonce)

## Sign up:
    0:  The client has [id], [password], [client_salt], [H_c] and [H_s].
        The server has [H_s].
    1:  The client calculates [hashed_id] and [hashed_password].
    2:  The client sends [id], [hashed_id] and [hashed_password] to the server.
    3:  The server asserts that [id] is not already registered in the
        database.
    4:  The server generates [server_id_salt] and [server_password_salt].
    5:  The server calculates [double_hashed_id] and [double_hashed_password].
    6:  The server stores [id], [double_hashed_id], [double_hashed_password],
        [server_id_salt], and [server_password_salt].

    E:  Sign-up can fail at step 3 (error A). The server then responds in a way
        indistinguishable from a successful response.
    A:  The server responds with the same message as it would if the request
        was successful.

## Sign in:
    0:  The client has [id], [password], [client_salt], [H_c] and [H_s].
        The server has [id], [server_id_salt], [server_password_salt],
        [H_s], [double_hashed_id], and [double_hashed_password].
    1:  The client calculates [hashed_id] and [hashed_password].
    2:  The client generates [client_nonce].
    3:  The client sends [id], [hashed_id] and [client_nonce] to the server.
    4:  The server asserts that [id] is registered in the database.
    5:  The server calculates [double_hashed_id].
    6:  The server asserts that [double_hashed_id] matches the value registered
        at sign up.
    7:  The server generates [server_nonce].
    8:  The server sends [server_password_salt] and [server_nonce] to the
        client.
    9:  The client calculates [double_hashed_password] and [client_signature].
    10: The client sends [client_signature] to the server.
    11: The server calculates [client_signature].
    12: The server asserts that [client_signature] matches the value sent by
        the client.
    13: The server calculates [server_signature].
    14: The server sends [server_signature] to the client.
    15: The client calculates [server_signature].
    16: The client asserts that [server_signature] matches the value sent by
        the server.

    E:  Sign-in can fail at step 4 or 6 (error A), step 12 (error B), or
        step 16 (error C). In the case of errors A and B, the server responds
        in a way indistinguishable from a successful response. In the case of
        error C, the client aborts the connection.
    A:  The server responds with an incorrect [server_password_salt]. This
        incorrect salt must be unique but consistent for the inputs, i.e. every
        call with an [id] and [hashed_id] must yield a different
        [server_password_salt] from calls with any other [id] or [hashed_id]
        but the same [server_password_salt] as previous and subsequent calls
        with the same [id] and [hashed_id].
    B:  The server responds with a randomly generated [server_signature].
    C:  The client aborts the connection.
